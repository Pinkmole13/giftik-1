<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Поймай подарок</title>

<style>
html, body {
    margin: 0;
    padding: 0;
    background: black;
    overflow: hidden;
    touch-action: none;
    font-family: monospace;
}

canvas {
    display: block;
}

#endScreen {
    position: fixed;
    inset: 0;
    background: black;
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: white;
    z-index: 10;
}

#photo {
    width: 90vw;
    max-width: 980px;
    aspect-ratio: 1960 / 1360;
    background-image: url("https://i.imgur.com/LsbkzB0.jpeg");
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    animation: sway 4s ease-in-out infinite;
}

@keyframes sway {
    0% { transform: rotate(-1deg); }
    50% { transform: rotate(1deg); }
    100% { transform: rotate(-1deg); }
}

#title {
    margin-top: 20px;
    font-size: 32px;
}

button {
    margin-top: 20px;
    padding: 10px 20px;
    font-size: 18px;
    background: black;
    color: white;
    border: 2px solid white;
}
</style>
</head>

<body>
<canvas id="game"></canvas>

<div id="endScreen">
    <div id="photo"></div>
    <div id="title">Поздравляем!</div>
    <button onclick="restart()">Пройти заново</button>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
resize();

window.addEventListener("resize", resize);
function resize() {
    canvas.width = innerWidth;
    canvas.height = innerHeight;
}

// ---------- Управление ----------
let touchStart = null;
canvas.addEventListener("touchstart", e => {
    touchStart = e.touches[0];
});
canvas.addEventListener("touchmove", e => {
    if (!touchStart) return;
    const t = e.touches[0];
    player.vx = (t.clientX - touchStart.clientX) * 0.02;
    player.vy = (t.clientY - touchStart.clientY) * 0.02;
    touchStart = t;
});

// ---------- Сущности ----------
const player = {
    x: 100, y: 100,
    vx: 0, vy: 0,
    speed: 3,
    step: 0
};

const gift = {
    x: 300, y: 300,
    vx: 4, vy: 4,
    speed: 6,
};

let snow = [];
let confetti = [];
let gameOver = false;

// ---------- Инициализация ----------
function init() {
    gameOver = false;
    snow = [];
    confetti = [];
    player.x = Math.random() * (canvas.width - 100) + 50;
    player.y = Math.random() * (canvas.height - 100) + 50;

    do {
        gift.x = Math.random() * canvas.width;
        gift.y = Math.random() * canvas.height;
    } while (Math.hypot(player.x - gift.x, player.y - gift.y) < 200);

    gift.vx = 4;
    gift.vy = 4;
}
init();

// ---------- Снег ----------
function spawnSnow() {
    snow.push({
        x: Math.random() * canvas.width,
        y: -10,
        r: 4 + Math.random() * 4,
        v: 0.5 + Math.random()
    });
}

// ---------- Рисование ----------
function drawPlayer() {
    ctx.fillStyle = "#aaa";
    ctx.fillRect(player.x - 10, player.y - 14, 20, 28); // тело
    ctx.fillRect(player.x - 6, player.y - 22, 12, 8); // голова
    ctx.fillRect(player.x - 2, player.y - 26, 4, 4); // кнопка

    player.step += 0.2;
    const s = Math.sin(player.step) * 4;

    ctx.fillRect(player.x - 16, player.y - 8 + s, 6, 16); // руки
    ctx.fillRect(player.x + 10, player.y - 8 - s, 6, 16);
    ctx.fillRect(player.x - 8, player.y + 14 - s, 6, 14); // ноги
    ctx.fillRect(player.x + 2, player.y + 14 + s, 6, 14);
}

function drawGift() {
    ctx.fillStyle = "red";
    ctx.fillRect(gift.x - 12, gift.y - 12, 24, 24);
    ctx.fillStyle = "gold";
    ctx.fillRect(gift.x - 2, gift.y - 12, 4, 24);
    ctx.fillRect(gift.x - 12, gift.y - 2, 24, 4);

    // ножки
    ctx.fillStyle = "#aaa";
    ctx.fillRect(gift.x - 10, gift.y + 12, 6, 10);
    ctx.fillRect(gift.x + 4, gift.y + 12, 6, 10);
}

// ---------- Обновление ----------
let slowTimer = 0;

function update(dt) {
    spawnSnow();

    // игрок
    player.x += player.vx;
    player.y += player.vy;
    player.x = Math.max(0, Math.min(canvas.width, player.x));
    player.y = Math.max(0, Math.min(canvas.height, player.y));

    // подарок
    const dx = gift.x - player.x;
    const dy = gift.y - player.y;
    const dist = Math.hypot(dx, dy);

    if (dist < 200) {
        gift.vx = (dx / dist) * gift.speed;
        gift.vy = (dy / dist) * gift.speed;
    }

    gift.x += gift.vx;
    gift.y += gift.vy;

    if (gift.x < 0 || gift.x > canvas.width) gift.vx *= -1;
    if (gift.y < 0 || gift.y > canvas.height) gift.vy *= -1;

    slowTimer += dt;
    if (slowTimer > 2000) {
        gift.speed *= 0.9;
        slowTimer = 0;
    }

    // столкновение
    if (dist < 20) endGame();

    // снег
    snow.forEach(s => s.y += s.v);
    snow = snow.filter(s => s.y < canvas.height + 20);
}

// ---------- Конец ----------
function endGame() {
    gameOver = true;
    document.getElementById("endScreen").style.display = "flex";
}

function restart() {
    document.getElementById("endScreen").style.display = "none";
    init();
}

// ---------- Цикл ----------
let last = performance.now();
function loop(t) {
    const dt = t - last;
    last = t;

    ctx.clearRect(0,0,canvas.width,canvas.height);

    if (!gameOver) {
        update(dt);
        ctx.fillStyle = "white";
        snow.forEach(s => {
            ctx.fillRect(s.x, s.y, s.r, s.r);
        });
        drawGift();
        drawPlayer();
    }

    requestAnimationFrame(loop);
}
loop(last);
</script>
</body>
</html>
