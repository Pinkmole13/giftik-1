<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Поймай подарок</title>

<style>
html, body {
    margin: 0;
    padding: 0;
    background: black;
    overflow: hidden;
    touch-action: none;
    font-family: monospace;
}

canvas { display: block; }

#endScreen {
    position: fixed;
    inset: 0;
    background: black;
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: white;
    z-index: 10;
}

#photo {
    width: 90vw;
    max-width: 980px;
    aspect-ratio: 1960 / 1360;
    background-image: url("https://i.imgur.com/LsbkzB0.jpeg");
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    animation: sway 4s ease-in-out infinite;
}

@keyframes sway {
    0% { transform: rotate(-1deg); }
    50% { transform: rotate(1deg); }
    100% { transform: rotate(-1deg); }
}

#title {
    margin-top: 20px;
    font-size: 32px;
}

button {
    margin-top: 20px;
    padding: 10px 20px;
    font-size: 18px;
    background: black;
    color: white;
    border: 2px solid white;
}
</style>
</head>

<body>
<canvas id="game"></canvas>

<div id="endScreen">
    <div id="photo"></div>
    <div id="title">Поздравляем!</div>
    <button onclick="restart()">Пройти заново</button>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resize() {
    canvas.width = innerWidth;
    canvas.height = innerHeight;
}
resize();
window.addEventListener("resize", resize);

// ---------- Игрок ----------
const player = {
    x: 0,
    y: 0,
    step: 0
};

// ---------- Подарок ----------
const gift = {
    x: 0,
    y: 0,
    vx: 0,
    vy: 0,
    speed: 6,
    active: false
};

let snow = [];
let gameOver = false;
let slowTimer = 0;

// ---------- Инициализация ----------
function init() {
    gameOver = false;
    snow = [];
    slowTimer = 0;

    player.x = canvas.width / 2;
    player.y = canvas.height / 2;

    do {
        gift.x = Math.random() * canvas.width;
        gift.y = Math.random() * canvas.height;
    } while (Math.hypot(player.x - gift.x, player.y - gift.y) < 250);

    gift.vx = 0;
    gift.vy = 0;
    gift.speed = 6;
    gift.active = false;
}
init();

// ---------- Снег (редкий и медленный) ----------
function spawnSnow() {
    if (Math.random() < 0.02) {
        snow.push({
            x: Math.random() * canvas.width,
            y: -10,
            r: 5 + Math.random() * 4,
            v: 0.2 + Math.random() * 0.3
        });
    }
}

// ---------- Рисование ----------
function drawPlayer() {
    player.step += 0.05;
    const s = Math.sin(player.step) * 2;

    // тело (синее)
    ctx.fillStyle = "#1e4fff";
    ctx.fillRect(player.x - 12, player.y - 10, 24, 30);

    // голова (жёлтая)
    ctx.fillStyle = "#ffd800";
    ctx.fillRect(player.x - 10, player.y - 24, 20, 14);

    // кнопка
    ctx.fillStyle = "#ccc";
    ctx.fillRect(player.x - 3, player.y - 30, 6, 6);

    // руки (жёлтые)
    ctx.fillStyle = "#ffd800";
    ctx.fillRect(player.x - 20, player.y - 6 + s, 8, 18);
    ctx.fillRect(player.x + 12, player.y - 6 - s, 8, 18);

    // ноги (синие)
    ctx.fillStyle = "#1e4fff";
    ctx.fillRect(player.x - 10, player.y + 20 - s, 8, 16);
    ctx.fillRect(player.x + 2, player.y + 20 + s, 8, 16);
}

function drawGift() {
    ctx.fillStyle = "red";
    ctx.fillRect(gift.x - 12, gift.y - 12, 24, 24);

    ctx.fillStyle = "gold";
    ctx.fillRect(gift.x - 2, gift.y - 12, 4, 24);
    ctx.fillRect(gift.x - 12, gift.y - 2, 24, 4);

    if (gift.active) {
        ctx.fillStyle = "#aaa";
        ctx.fillRect(gift.x - 10, gift.y + 12, 6, 10);
        ctx.fillRect(gift.x + 4, gift.y + 12, 6, 10);
    }
}

// ---------- Обновление ----------
function update(dt) {
    spawnSnow();

    const dx = gift.x - player.x;
    const dy = gift.y - player.y;
    const dist = Math.hypot(dx, dy);

    // активация подарка
    if (dist < 200 && !gift.active) {
        gift.active = true;
    }

    if (gift.active) {
        gift.vx = (dx / dist) * gift.speed;
        gift.vy = (dy / dist) * gift.speed;

        gift.x += gift.vx;
        gift.y += gift.vy;

        if (gift.x < 0 || gift.x > canvas.width) gift.vx *= -1;
        if (gift.y < 0 || gift.y > canvas.height) gift.vy *= -1;

        slowTimer += dt;
        if (slowTimer > 2000) {
            gift.speed *= 0.9;
            slowTimer = 0;
        }
    }

    if (dist < 20) endGame();

    snow.forEach(s => s.y += s.v);
    snow = snow.filter(s => s.y < canvas.height + 20);
}

// ---------- Конец ----------
function endGame() {
    gameOver = true;
    document.getElementById("endScreen").style.display = "flex";
}

function restart() {
    document.getElementById("endScreen").style.display = "none";
    init();
}

// ---------- Цикл ----------
let last = performance.now();
function loop(t) {
    const dt = t - last;
    last = t;

    ctx.clearRect(0, 0, canvas.width, canvas.height);

    if (!gameOver) {
        update(dt);

        ctx.fillStyle = "white";
        snow.forEach(s => ctx.fillRect(s.x, s.y, s.r, s.r));

        drawGift();
        drawPlayer();
    }

    requestAnimationFrame(loop);
}
loop(last);
</script>
</body>
</html>
